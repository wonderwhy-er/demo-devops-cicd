name: ğŸ” Pull Request Checks

on:
  pull_request:
    branches: [ main, develop ]
    types: [opened, synchronize, reopened]

jobs:
  pr-checks:
    name: ğŸ” PR Quality Checks
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        
    - name: ğŸŸ¢ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'
        cache: 'npm'
        
    - name: ğŸ“¦ Install dependencies
      run: npm ci
      
    - name: ğŸ§¹ Lint check
      run: npm run lint
      
    - name: ğŸ§ª Run tests with coverage
      run: npm run test:coverage
      
    - name: ğŸ“Š Comment coverage report
      uses: romeovs/lcov-reporter-action@v0.3.1
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        lcov-file: ./coverage/lcov.info
        delete-old-comments: true
        
    - name: ğŸ” Check for breaking changes
      run: |
        echo "Checking for breaking changes..."
        git diff --name-only origin/main...HEAD | grep -E '\.(js|html|css)$' || true
        
    - name: ğŸ“ Check file sizes
      run: |
        echo "Checking file sizes..."
        find . -name "*.js" -o -name "*.css" -o -name "*.html" | xargs ls -lh
        
  preview:
    name: ğŸ” Preview Deployment
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ”§ Setup preview environment
      run: |
        echo "Setting up preview environment..."
        echo "Preview would be available at: https://preview-${{ github.event.number }}.netlify.app"
        
    - name: ğŸ’¬ Comment preview link
      uses: actions/github-script@v7
      with:
        script: |
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: 'ğŸ” **Preview Environment**\n\nThis PR will be available for preview once merged.\n\nğŸ“Š **Quality Checks**\n- âœ… Linting passed\n- âœ… Tests passed\n- âœ… Coverage report generated\n\n*This is an automated message.*'
          })
